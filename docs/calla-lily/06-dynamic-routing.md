---
title: "[...slug].js Dynamic Routing"
sidebar_position: 6
contributor: Kevin Jang
---
As stated in the previous page, the TinaCMS data is what is fed into the rendered pages. 

When you view the repository code, there is a `_posts` directory that hosts all of the markdown pages of the literature and art that ends up being displayed on the website. The content of these pages is what ends up on the website, but the formatting of the files are templated into a different layout. This is done through the `pages` file `[...slug].js`. 

From the Next.js documentation on dynamic routing, the purpose is to create URLs for pages in a programmatic manner that even editors can do on their own. These URLs are based on the filepath from the `_posts` directory. 

When an editor publishes a new work they must create a new file and give it a title. This title is previewed as the filename which will be used as the public URL. Developers can do the same thing through the filesystem but with the added benefit of being able to rename the files and thus change the URL. The `[...slug]` is the syntax for a catch-all segment and this is what collects the subdirectory paths to the filenames.

## Layout Modifications 

The purpose of this `[...slug].js` for generating static pages at Other People is to provide different layout schemes if necessary to the posts. Since most posts use the same layout, this template page suffices. However, for specific themes or components like content warnings or experimental posts such as `2023/missed-connections`, the `[...slug].js` file can read in specific information from the markdown file to do additional operations and even modify the layout without having to define other public pages in the `pages` directory.

### Custom Components (bottom of TinaCMS editor frontmatter)

```js
// Add JS files that affect all posts
useEffect(() => {
  copyright();
  pageChange(data.post.theme);
}); // Does not trigger once to ensure copyright effect works
```

The copyright and page change functions are respectively defined in the `lib/copyright.js` and `lib/bgTheme.js` files. Both are automatically called when the literature or arts webpage is loaded. 

Copyright, or copy-preventing pages has its own documentation decision change at the [Pink-Currents ADR](docs/pink-currents/adr/copyright-protections). Every work should disable copy actions on the pages to reduce the chance of plagarism and reposting the works online without permission.

The reason why the background theme is called on every load is because one work might force the theme to dark mode as the work is intended to be viewed that way while other works use the user's system theme preference. If the theme was stuck on dark mode without going back to the user's default theme, this might ruin their user experience.

### getStaticPaths

This is the most important part of the dynamic routing system as it figures out the path of each post and stores it for statically generating all paths created in `[...slug].js`. It uses the GraphQL paginated data of all posts and iterates over each page to create the pathnames. 

:::warning
The commented-out parts in getStaticPaths and getPageData is the process to remove the year subdirectory from the public URLs. Although it visually does not produce any errors for the end user, it causes the console to throw many errors about 404 resource not found. It is not advised to enable this because there could be more side-effects. The new URLs have been resolved as a note in the 404 page describing the change.
:::

### getStaticProps -> Recommendations

The recommendation results generated by the recommendation model built in [docs/recommendation-system](docs/recommendation-system) is fetched here and then fed through the app context to enable recommendations in the search results. Refer to the [docs/calla-lily/search](docs/calla-lily/search) for a more detailed explanation of what it does.


### Experimental Post Activation

```js
export const Experimental = ({ title }) => {
    useEffect(() => {
        switch (title) {
            // Vanilla JS using document or window
        }
    });

    switch (title) {
        return <Script 
          src={}
          onReady={() => {
            // Do something after importing a JS file is complete 
            // Vanilla JS using document or window
          }}
        />
    }
}
```

There are two ways to define the running operations of scripts using `useEffect` or adding a `Next/Script` to the webpage. The `useEffect` should be used when there is no external JavaScript file to import for that work. Usually this is for a small modification that requires selecting elements and doing something with them.

The section that is not within the `useEffect` block usually returns a `Next/Script` and appends it to the webpage. This is usually used when there is a larger script payload such as running truly experimental works such as `missed-connections` or `you-have-created-an-imaginary-friend`. The additional methods in the `onReady` function are meant to perform operations that are specific to that work because the imported JavaScript file is usually a generic, modular program to run an operation. Therefore, the program is able to be reused for other experimental works without changing much inside the program.

### SEO and Robots

```js
<Head>
  <meta name="robots" content="all"/>
  <meta name="robots" content="noimageindex"/>
</Head>
<NextSeo
  canonical={canonical}
  description={excerpt}
  excerpt={excerpt}
  openGraph={{
    type: 'article',
    images: [{ url: previewImg }],
}}
/>
```

Posts usually have a 100/100 Lighthouse SEO score and one of the factors responsible for it is the meta tags which control the indexing permissions granted to site crawlers. The first meta tag allows all crawling and indexing permissions, yet the second tag overwrites and disallows the image indexing permission. This should prevent artwork from being displayed in search results to prevent them from being copied directly there. 

The NextSeo tag activates previews that are displayed on social cards when the link to the page is posted and shared. It will get an excerpt of the first lines in the work and display the thumbnail illustration if available. The excerpt has already been cleaned of HTML tags and newline symbols through a function that gets the post data in `getPostDataAPI()` from `lib/posts.js`.
